<template>
  <div class="container w-100 flex-column-center">
    <div class="content flex-column-start-align-start w-90">
      <div class="header w-100 flex-column-start-align-start">
        <h1 class="text-primary">{{ activeVulnerability.title }}</h1>
        <span> {{ activeVulnerability.comment }} </span>
      </div>
      <div class="data w-100 h-30 flex-column-start-align-start">
        <h2 class="text-primary">Dados da Vulnerabilidade</h2>
        <div class="w-100 pt-3 pb-3">
          <span> Tipo de Vulnerabilidade: </span>
          <span class="ml-2 text-primary">
            {{ getVulnerabilityTypeName(activeVulnerability.type) }}</span
          >
        </div>
        <div class="w-100 pt-0 pb-0">
          <span>Grau de Criticidade: </span>
          <img
            class="ml-2"
            :src="
              require(`../../src/assets/icons/critical-${activeVulnerability.criticalityLevel}-colored.svg`)
            "
            :alt="
              'Grau de Criticidade: ' +
              getCriticalityLevelName(activeVulnerability.criticalityLevel)
            "
            :title="
              'Grau de Criticidade: ' +
              getCriticalityLevelName(activeVulnerability.criticalityLevel)
            "
          />
        </div>
      </div>
      <div class="evidences">
        <h2 class="text-primary">Evidências</h2>
        <div class="row-box flex-justify-center">
          <div id="row-images" class="w-100 flex-justify-center" />
        </div>
      </div>
      <div class="solution w-100 flex-column-start-align-start">
        <h2 class="text-primary">Evidências</h2>
        <span> {{ activeVulnerability.comment }} </span>
      </div>
      <div class="flex-justify-center w-100">
        <DefaultButton
          width="240"
          icon="fas fa-arrow-left"
          text="Voltar"
          @click="goToHomePage()"
        />
      </div>
    </div>
  </div>
</template>

<script>
import GlobalMethods from "../mixins/GlobalMethods";
import { mapActions, mapState } from "vuex";
import DefaultButton from "../components/buttons/DefaultButton";

export default {
  name: "ShowVulnerability",
  components: { DefaultButton },
  mixins: [GlobalMethods],
  mounted() {
    let id = this.$route.params.id;
    this.action_setActiveVulnerability(parseInt(id));
    this.handleImages();
  },
  methods: {
    ...mapActions(["action_setActiveVulnerability"]),
    handleImages() {
      const files = this.activeVulnerability.evidences;
      for (let i = 0; i < files.length; i++) {
        const file = files[i];

        if (!file.type.startsWith("image/")) {
          continue;
        }

        const preview = document.getElementById("row-images");
        const img = document.createElement("img");
        img.classList.add("img");
        img.file = file;
        img.style.margin = "20px";
        img.style.maxWidth = "700px";
        preview.appendChild(img);

        const reader = new FileReader();
        reader.onload = (function (aImg) {
          return function (e) {
            aImg.src = e.target.result;
          };
        })(img);
        reader.readAsDataURL(file);
      }
    },
  },
  computed: {
    ...mapState({
      activeVulnerability: (state) => state.activeVulnerability,
    }),
  },
};
</script>

<style scoped lang="scss">
* {
  color: $textColor;
  font-size: 20px;
}

.text-primary {
  color: $primaryColor;
}

.content {
  background: $secondaryColor;
  border-radius: 20px;
  padding: 30px;
}

.header,
.data,
.evidences,
.solution {
  padding-bottom: 40px;
}

.header h1 {
  font-size: 40px;
  font-weight: bold;
  font-family: Roboto-Bold, sans-serif;
}

.header span {
  font-size: 24px;
  color: $textColor;
}

span {
  padding-bottom: 5px;
}

.data h2,
.evidences h2,
.solution h2 {
  padding-bottom: 10px;
  font-weight: bold;
  font-family: Roboto-Bold, sans-serif;
  font-size: 30px;
}
.row-box {
  max-height: 500px;
  border: 1px dashed $textColor;
  background: $secondaryColor;
  border-radius: 10px;
  overflow: auto;
  flex-wrap: wrap;
}
#row-images {
  width: 100%;
  padding: 0 20px;
  flex-wrap: wrap;
}
</style>
