<template>
  <div
    id="vulnerability-row"
    class="w-100 is-clickable flex-justify-between"
    @click="$emit('showClick', vulnerability)"
  >
    <span class="flex-justify-center" style="width: 10%">
      <img
        :src="
          require(`../../../src/assets/icons/critical-${vulnerability.criticalityLevel.value}.svg`)
        "
        :alt="'Grau de Criticidade: ' + vulnerability.criticalityLevel.name"
        :title="'Grau de Criticidade: ' + vulnerability.criticalityLevel.name"
      />
    </span>
    <span class="flex-justify-center" style="width: 25%">
      {{ vulnerability.title }}
    </span>
    <span class="flex-justify-center" style="width: 20%">
      {{ vulnerability.type.name }}
    </span>
    <div class="flex-justify-center" style="width: 25%">
      <div
        v-if="vulnerability.evidences && vulnerability.evidences.length > 0"
        id="row-preview"
        class="is-clickable"
      ></div>
      <span class="error-text" v-else> Sem EvidÃªncia</span>
    </div>
    <span class="flex-justify-center" style="width: 10%">
      <i
        title="Editar Vulnerabilidade"
        :class="vulnerability.edit"
        class="is-clickable edit-button"
        @click="$emit('editClick', vulnerability)"
      ></i>
    </span>
    <span class="flex-justify-center" style="width: 10%">
      <i
        title="Excluir Vulnerabilidade"
        :class="vulnerability.delete"
        class="is-clickable delete-button"
        @click="$emit('deleteClick', vulnerability)"
      ></i>
    </span>
  </div>
</template>

<script>
export default {
  name: "VulnerabilityRow",
  props: {
    vulnerability: {},
  },
  mounted() {
    this.showFirstPreviewImage();
  },
  methods: {
    print() {
      console.log("VISAO");
    },
    showFirstPreviewImage() {
      const file = this.vulnerability.evidences[0];

      const preview = document.getElementById("row-preview");
      const img = document.createElement("img");
      img.classList.add("img");
      img.file = file;
      img.style.margin = "5px";
      img.style.maxHeight = "70px";
      img.style.maxWidth = "100%";
      preview.appendChild(img);

      const reader = new FileReader();
      reader.onload = (function (aImg) {
        return function (e) {
          aImg.src = e.target.result;
        };
      })(img);
      reader.readAsDataURL(file);
    },
  },
};
</script>

<style scoped lang="scss">
* {
  font-size: 18px;
}

#vulnerability-row {
  height: 80px;
  padding: 0 40px;
  border-bottom: 1px solid $blackColor;
  background-color: $rowColor;
  //user-select: auto !important;
}

#vulnerability-row:hover {
  background-color: $activeRowColor;
}

.span i:hover ~ #vulnerability-row {
  pointer-events: none;
}

.error-text {
  color: $dangerColor;
}

.edit-button:hover {
  color: $primaryColor;
}

.delete-button:hover {
  color: $dangerColor;
}
</style>
